<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on Roberts blog</title><link>https://www.robert-sokolewicz.nl/posts/</link><description>Recent content in Posts on Roberts blog</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sun, 24 Sep 2023 00:00:00 +0000</lastBuildDate><atom:link href="https://www.robert-sokolewicz.nl/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>Unit testing - Classical vs. London Approaches</title><link>https://www.robert-sokolewicz.nl/posts/14_unit_testing/</link><pubDate>Sun, 24 Sep 2023 00:00:00 +0000</pubDate><guid>https://www.robert-sokolewicz.nl/posts/14_unit_testing/</guid><description>Most, if not all, software projects suffer from the same problem. When starting the project it&amp;rsquo;s very easy to include new features. One feature might take one day to implement, but as the code base grows, implementing something new will take a week, a month, or half a year until it&amp;rsquo;s impossible to implement something without breaking something else. Different parts of the code depend on each other and this can create a cascading effect where a small change propagates throughout the entire codebase breaking a lot of stuff.</description><content>&lt;p>Most, if not all, software projects suffer from the same problem. When starting the project it&amp;rsquo;s very easy to include new features. One feature might take one day to implement, but as the code base grows, implementing something new will take a week, a month, or half a year until it&amp;rsquo;s impossible to implement something without breaking something else. Different parts of the code depend on each other and this can create a cascading effect where a small change propagates throughout the entire codebase breaking a lot of stuff.&lt;/p>
&lt;p>Unit tests are safeguards that help the developer in writing code that does not break the existing code, making it easier to make progress when working on the codebase.&lt;/p>
&lt;figure class="center" >
&lt;img src="images/1.svg" />
&lt;figcaption class="center" >Figure 1. The time that we spend on developing and expanding the code base grows exponentially with the amount of progress already made.&lt;/figcaption>
&lt;/figure>
&lt;p>In the early stages of a project, it is probably easier and faster to implement new features than it is to write unit tests for them. For smaller projects implementing unit tests might even hinder the progress of the project, but in the long run, it is worthwhile.&lt;/p>
&lt;h2 id="what-is-a-unit-test">What is a unit test?&lt;/h2>
&lt;p>Let&amp;rsquo;s assume that our codebase has a &lt;code>Cat&lt;/code> class that represents a cat that can meow and always feels hungry until it gets some food to eat. Some unit tests for this class could be something like&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">test_is_hungry&lt;/span>():
cat &lt;span style="color:#f92672">=&lt;/span> Cat(&lt;span style="color:#e6db74">&amp;#34;funnywhiskers&amp;#34;&lt;/span>)
&lt;span style="color:#66d9ef">assert&lt;/span> cat&lt;span style="color:#f92672">.&lt;/span>is_hungry &lt;span style="color:#f92672">is&lt;/span> True
&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">test_meow&lt;/span>():
cat &lt;span style="color:#f92672">=&lt;/span> Cat(&lt;span style="color:#e6db74">&amp;#34;funnywhiskers&amp;#34;&lt;/span>)
&lt;span style="color:#66d9ef">assert&lt;/span> cat&lt;span style="color:#f92672">.&lt;/span>meow() &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Meow!&amp;#34;&lt;/span>
&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">test_eat&lt;/span>():
cat &lt;span style="color:#f92672">=&lt;/span> Cat(&lt;span style="color:#e6db74">&amp;#34;funnywhiskers&amp;#34;&lt;/span>)
&lt;span style="color:#66d9ef">assert&lt;/span> cat&lt;span style="color:#f92672">.&lt;/span>eat() &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Yum!&amp;#34;&lt;/span>
&lt;span style="color:#66d9ef">assert&lt;/span> cat&lt;span style="color:#f92672">.&lt;/span>is_hungry() &lt;span style="color:#f92672">is&lt;/span> False
&lt;span style="color:#66d9ef">assert&lt;/span> cat&lt;span style="color:#f92672">.&lt;/span>eat() &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;I&amp;#39;m not hungry.&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>In this example, we see that even though we have one &lt;code>Cat&lt;/code> class, the tests are split into smaller pieces, each testing a small aspect of that class. This is where the name &amp;ldquo;unit&amp;rdquo; comes from. Furthermore, each test is small, to the point, and fast. And lastly, each test is &lt;em>isolated&lt;/em> from each other. What isolation means exactly, we will explain shortly.&lt;/p>
&lt;p>A unit test has the following properties:&lt;/p>
&lt;ol>
&lt;li>it verifies a piece of code.&lt;/li>
&lt;li>it is fast.&lt;/li>
&lt;li>it is isolated.&lt;/li>
&lt;/ol>
&lt;p>The requirement that a unit test is isolated is something that many people have strong opinions about, so strong even, that we broadly have two schools of thought: The London (mockist) and the Detroit (classical) school.&lt;/p>
&lt;h2 id="the-classic-view-of-isolation">The classic view of isolation&lt;/h2>
&lt;p>Let us examine the classical school first. Imagine that our cat codebase has grown quite a bit and now we also have an &lt;code>Owner&lt;/code> class that is responsible for getting the food for the cat. Again, a simple test to test this functionality would be&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">test_classical_eat&lt;/span>():
cat &lt;span style="color:#f92672">=&lt;/span> Cat(&lt;span style="color:#e6db74">&amp;#34;funnywhiskers&amp;#34;&lt;/span>)
owner &lt;span style="color:#f92672">=&lt;/span> Owner(&lt;span style="color:#e6db74">&amp;#34;Robert&amp;#34;&lt;/span>)
food &lt;span style="color:#f92672">=&lt;/span> owner&lt;span style="color:#f92672">.&lt;/span>get_food(&lt;span style="color:#e6db74">&amp;#34;fish&amp;#34;&lt;/span>)
&lt;span style="color:#66d9ef">assert&lt;/span> cat&lt;span style="color:#f92672">.&lt;/span>eat(food) &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Yum! Ate fish.&amp;#34;&lt;/span>
&lt;span style="color:#66d9ef">assert&lt;/span> cat&lt;span style="color:#f92672">.&lt;/span>is_hungry &lt;span style="color:#f92672">is&lt;/span> False
&lt;/code>&lt;/pre>&lt;/div>&lt;p>There is a small issue with this test, however. We are testing whether the &lt;code>.eat&lt;/code> method and &lt;code>.is_hungry&lt;/code> method are working as intended, but what if we introduce a change in the codebase corresponding to the &lt;code>Owner.get_food&lt;/code> method in such a way that &lt;code>cat.eat(food) != &amp;quot;Yum! Ate fish.&amp;quot;&lt;/code>. The test will fail, but not because anything is wrong with our cat, but because we changed the behavior elsewhere. This is the classic example of touching one part of the code and it breaks something else. This cascading effect of a bug that propagates throughout the code base and fails a lot of tests, is not necessarily wrong. If many tests fail because we made a change to &lt;code>.get_food&lt;/code> it means that the codebase heavily depends on it and we discovered that it&amp;rsquo;s quite an essential piece of code.&lt;/p>
&lt;p>The downside, however, is that when a lot of tests fail it becomes difficult to isolate where the problem exactly is. As mentioned, in this case, we&amp;rsquo;re testing the eating behavior of the cat, but the problem lies in the &lt;code>.get_food&lt;/code> method of &lt;code>Owner&lt;/code>. And according to the Londonists, this is due to isolation.&lt;/p>
&lt;h2 id="the-london-view-of-isolation">The London view of isolation&lt;/h2>
&lt;p>When testing a piece of code that depends on other parts of the codebase, the Londonists say we should replace those dependencies with dummies (also called doubles or mocks). The above test then becomes&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">test_london_eat&lt;/span>(pytest_mock):
mock_owner &lt;span style="color:#f92672">=&lt;/span> pytest_mock&lt;span style="color:#f92672">.&lt;/span>Mock(spec&lt;span style="color:#f92672">=&lt;/span>Owner)
mock_owner&lt;span style="color:#f92672">.&lt;/span>get_food&lt;span style="color:#f92672">.&lt;/span>return_value &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;fake fish&amp;#34;&lt;/span>
cat &lt;span style="color:#f92672">=&lt;/span> Cat(&lt;span style="color:#e6db74">&amp;#34;funnywhiskers&amp;#34;&lt;/span>)
food &lt;span style="color:#f92672">=&lt;/span> mock_owner&lt;span style="color:#f92672">.&lt;/span>get_food(&lt;span style="color:#e6db74">&amp;#34;fake fish&amp;#34;&lt;/span>)
&lt;span style="color:#66d9ef">assert&lt;/span> cat&lt;span style="color:#f92672">.&lt;/span>eat(food) &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Yum! Ate fake fish.&amp;#34;&lt;/span>
&lt;span style="color:#66d9ef">assert&lt;/span> cat&lt;span style="color:#f92672">.&lt;/span>is_hungry &lt;span style="color:#f92672">is&lt;/span> False
&lt;/code>&lt;/pre>&lt;/div>&lt;p>where we used the mocking capability of pytest to create a fake version of &lt;code>Owner&lt;/code>. The line &lt;code>mock_owner.get_food.return_value&lt;/code> sets the return value of &lt;code>get_food&lt;/code> regardless of how &lt;code>get_food&lt;/code> is implemented in the code base.&lt;/p>
&lt;h2 id="a-note-on-dependencies">A note on dependencies&lt;/h2>
&lt;p>In the classical style of testing, it is still important that unit tests do not depend on each other. Certain dependencies that are shared, should still be mocked even in the classical style. For example, updating a shared database might cause issues with other tests that operate on the same database. Imagine a hundred tests that all add the same cat named &lt;em>funnywhiskers&lt;/em> to the database. This can cause many problems while testing, either because the database requires unique cat names or maybe because there is a test that adds and removes &lt;em>Funnywhiskers&lt;/em> from the database and asserts that no there is no &lt;em>Funnywhiskers&lt;/em> in the database anymore.&lt;/p>
&lt;h2 id="comparisons">Comparisons&lt;/h2>
&lt;p>As mentioned above, isolation in the London school attempts to isolate dependencies and as such test small &amp;ldquo;units&amp;rdquo; of code. This has a few side effects though (some positive, some negative). These tests tend to be more focussed on the implementation of code, rather than the behavior of code. In the &lt;code>get_food&lt;/code> example, if we refactor the code so that &lt;code>get_food&lt;/code> returns an instance of a &lt;code>Food&lt;/code> object, and &lt;code>.eat&lt;/code> accepts this food instance the classical test will pass, whereas the London test will fail because &lt;code>get_food&lt;/code> is mocked in a way to return a &lt;code>str&lt;/code> object, rather than a &lt;code>Food&lt;/code> object. Consequently, classical tests generally protect better against code refactors.&lt;/p>
&lt;p>One benefit of London-style testing is that if you have a large code base with a lot of tests, if you introduce a bug in an important piece of code it will only cause relevant tests to fail and allow you to quickly figure out where you introduced the bug. In the classical style of unit testing, you will see many more tests that fail because of the dependency issue. If you run all the unit tests frequently however, (e.g. with every commit or even more often) you should be able to quickly figure out what went wrong anyway because you haven&amp;rsquo;t made many changes yet. So in practice, this shouldn&amp;rsquo;t be too big of a problem for developers.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Aspect&lt;/th>
&lt;th>Classical (Detroit) School&lt;/th>
&lt;th>London (Mockist) School&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;strong>Isolation&lt;/strong>&lt;/td>
&lt;td>Units are not isolated from each other; only the tests are isolated.&lt;/td>
&lt;td>Units under test are isolated from each other.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Unit Under Test&lt;/strong>&lt;/td>
&lt;td>A unit of behavior.&lt;/td>
&lt;td>A unit of code, usually a class.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Dependencies&lt;/strong>&lt;/td>
&lt;td>Only shared dependencies are replaced with test doubles.&lt;/td>
&lt;td>All dependencies except immutable ones are replaced with test doubles.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Granularity&lt;/strong>&lt;/td>
&lt;td>May not provide as fine-grained control as the London School.&lt;/td>
&lt;td>Provides better granularity.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Ease of Testing&lt;/strong>&lt;/td>
&lt;td>Less focused on ease of testing large graphs of interconnected classes.&lt;/td>
&lt;td>Makes it easier to test large graphs of interconnected classes.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Debugging&lt;/strong>&lt;/td>
&lt;td>Doesn&amp;rsquo;t make it particularly easy or hard to find which functionality contains a bug.&lt;/td>
&lt;td>Easier to find which functionality contains a bug.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Issues&lt;/strong>&lt;/td>
&lt;td>Does not hide issues with code design.&lt;/td>
&lt;td>May hide issues with code design due to focus on units of code rather than units of behavior.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Over-Specification&lt;/strong>&lt;/td>
&lt;td>Less likely to couple tests to the system under test’s (SUT’s) implementation details.&lt;/td>
&lt;td>Higher risk of over-specification; tests could become coupled to the SUT’s implementation details.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></content></item><item><title>Debugging gitlab pipeline docker containers</title><link>https://www.robert-sokolewicz.nl/posts/13_gitlab_docker/</link><pubDate>Thu, 24 Aug 2023 00:00:00 +0000</pubDate><guid>https://www.robert-sokolewicz.nl/posts/13_gitlab_docker/</guid><description>docker images and containers Sometimes a pipeline that is running on GitLab has unexpected behavior, for example when a build is different from when you execute a build locally on your laptop. For debugging it is very useful to have the same environment, and sometimes just running a fresh conda environment and installing all the requirements is not enough.
A container is merely an instance that is running a docker image, and so all we need to do is find the Docker image reference in the GitLab registry and we&amp;rsquo;re good to go.</description><content>&lt;h2 id="docker-images-and-containers">docker images and containers&lt;/h2>
&lt;p>Sometimes a pipeline that is running on GitLab has unexpected behavior, for example when a build is different from when you execute a build locally on your laptop. For debugging it is very useful to have the same environment, and sometimes just running a fresh conda environment and installing all the requirements is not enough.&lt;/p>
&lt;p>A container is merely an instance that is running a docker image, and so all we need to do is find the Docker image reference in the GitLab registry and we&amp;rsquo;re good to go.&lt;/p>
&lt;h2 id="looking-up-the-docker-image-reference">looking up the docker image reference&lt;/h2>
&lt;ol>
&lt;li>in your GitLab repository, navigate in the menu on the left, to Deploy &amp;gt; Container Registry
&lt;figure class="center" >
&lt;img src="images/image.png" />
&lt;/figure>
&lt;/li>
&lt;li>search for the branch name&lt;/li>
&lt;li>click the copy-to-clipboard button&lt;/li>
&lt;/ol>
&lt;figure class="center" >
&lt;img src="images/image-2.png" />
&lt;/figure>
&lt;p>Sometimes you have a pipeline that creates another docker image, in which case you can often find the image name in the log of your pipeline. In each case, the reference will look similar to:&lt;/p>
&lt;pre>&lt;code>registry.gitlab.com/&amp;lt;repo&amp;gt;/&amp;lt;pipeline name&amp;gt;/python3.8@sha256:ce3f78d603803740615069e7680715d3707998671db4ee32fbec3e98f4dc2d53
&lt;/code>&lt;/pre>&lt;h2 id="executing-the-docker-container">executing the docker container&lt;/h2>
&lt;p>The registry is not publicly available by default, so before creating a new docker container, you&amp;rsquo;ll have to log into the registry first:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">docker login registry.gitlab.com
&lt;/code>&lt;/pre>&lt;/div>&lt;p>which will ask for your GitLab username and password. If you have two-factor authentication enabled, you&amp;rsquo;ll have to create an authentication token in the browser and use that as your password instead.&lt;/p>
&lt;p>Now that we are logged in, you can create a new container that will run this image for you with the command:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">docker run -it --name my-container &amp;lt;image-path&amp;gt; /bin/bash
&lt;/code>&lt;/pre>&lt;/div>&lt;p>here:&lt;/p>
&lt;ul>
&lt;li>the &lt;code>-it&lt;/code> flag makes sure that the container runs in an interactive mode&lt;/li>
&lt;li>&lt;code>&amp;lt;image-path&amp;gt;&lt;/code> should be replaced with the image path that we just copied&lt;/li>
&lt;li>and &lt;code>/bin/bash&lt;/code> is the command that will be executed first. This is often optional, but sometimes there&amp;rsquo;s a default &lt;code>CMD&lt;/code> specified in the image that we would like to override while debugging.&lt;/li>
&lt;/ul>
&lt;h2 id="troubleshooting">troubleshooting&lt;/h2>
&lt;h3 id="cannot-connect-to-docker-daemon">cannot connect to Docker Daemon&lt;/h3>
&lt;p>The first time I tried this, I ran into the following problem. Running &lt;code>docker run&lt;/code> would give me back&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">docker: Cannot connect to the Docker daemon at unix:///var/run/docker.sock
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Many solutions can be found on Stackoverflow, but for me, the problem was that I was running Docker inside WSL, but I had installed Docker both in my Ubuntu partition and on Windows. The solution was to uninstall both, install the Windows version and in the settings, you specify that you want to run docker inside WSL.&lt;/p>
&lt;h3 id="permission-denied-while-trying-to-connect">permission denied while trying to connect&lt;/h3>
&lt;p>then I got this problem&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">docker: Got permission denied &lt;span style="color:#66d9ef">while&lt;/span> trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Post http://%2Fvar%2Frun%2Fdocker.sock/v1.35/containers/create: dial unix /var/run/docker.sock: connect: permission denied. See &lt;span style="color:#e6db74">&amp;#39;docker run --help&amp;#39;&lt;/span>.
&lt;/code>&lt;/pre>&lt;/div>&lt;p>when using Unix (WSL/Linux/macOS) you have to run docker either as a super user (&lt;code>sudo docker run&lt;/code>) or you have to add yourself to the &lt;code>docker&lt;/code> group:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">sudo groupadd docker
sudo usermod -aG docker $USER
newgrp docker
&lt;/code>&lt;/pre>&lt;/div>&lt;p>The first line creates the &lt;code>docker&lt;/code> group (if it doesn&amp;rsquo;t yet exist), the second line adds you to that group (&lt;code>-aG&lt;/code> stands for append and group), and the third logs you into that group. The third option is just so that you don&amp;rsquo;t have to reload the shell. You could just as well reopen your terminal.&lt;/p></content></item><item><title>Git ahoy! A Pirate's Tale of Version Control</title><link>https://www.robert-sokolewicz.nl/posts/12_gitbeard/</link><pubDate>Mon, 10 Jul 2023 00:00:00 +0000</pubDate><guid>https://www.robert-sokolewicz.nl/posts/12_gitbeard/</guid><description>Adventure Begins As the dawn cracks over the horizon, Captain Gitbeard, a notorious pirate, and his crew of misfits aboard the ship, &amp;ldquo;The Digital Marauder,&amp;rdquo; sail through the emerald waves of the Caribbean. They maintain an inventory of their loot with a shared file named loot.txt version controlled through git. But as the crew is always a bit tipsy, they&amp;rsquo;ve been known to commit a few mistakes now and then.</description><content>&lt;h2 id="adventure-begins">Adventure Begins&lt;/h2>
&lt;p>As the dawn cracks over the horizon, Captain Gitbeard, a notorious pirate, and his crew of misfits aboard the ship, &amp;ldquo;The Digital Marauder,&amp;rdquo; sail through the emerald waves of the Caribbean. They maintain an inventory of their loot with a shared file named &lt;code>loot.txt&lt;/code> version controlled through git. But as the crew is always a bit tipsy, they&amp;rsquo;ve been known to commit a few mistakes now and then.&lt;/p>
&lt;p>Their &lt;code>loot.txt&lt;/code> file at the moment looks like this:&lt;/p>
&lt;pre>&lt;code>Pieces of Eight: 500
Gold Bars: 20
Jewelled Necklaces: 15
Diamonds: 7
&lt;/code>&lt;/pre>&lt;p>The git log shows:&lt;/p>
&lt;pre>&lt;code>commit 1234567
Author: Captain Gitbeard &amp;lt;gitbeard@pirate.net&amp;gt;
Date: Fri Jul 7 10:00:00 2023
Initial loot list.
&lt;/code>&lt;/pre>&lt;h2 id="a-blunder-at-plunder">A Blunder at Plunder&lt;/h2>
&lt;p>After a successful raid on a Spanish galleon, the crew updates the &lt;code>loot.txt&lt;/code> file with their new treasures. First Mate Morgan, a bit too merry with rum, updates the file as:&lt;/p>
&lt;pre>&lt;code>Pieces of Eight: 1500
Gold Bars: 120
Jewelled Necklaces: 150
Diamonds: 170
&lt;/code>&lt;/pre>&lt;p>He then commits this with the message &amp;ldquo;Plunder from the Spanish galleon&amp;rdquo;. He forgot that the crew only found 100 new Pieces of Eight, 10 new Gold Bars, 5 new Necklaces, and 3 new Diamonds.&lt;/p>
&lt;p>The git history now looks like:&lt;/p>
&lt;pre>&lt;code>commit 7654321
Author: First Mate Morgan &amp;lt;morgan@pirate.net&amp;gt;
Date: Sat Jul 8 12:00:00 2023
Plunder from the Spanish galleon.
commit 1234567
Author: Captain Gitbeard &amp;lt;Gitbeard@pirate.net&amp;gt;
Date: Fri Jul 7 10:00:00 2023
Initial loot list.
&lt;/code>&lt;/pre>&lt;p>Captain Gitbeard realizes the blunder and orders Morgan to amend the last commit with the correct numbers. Morgan runs:&lt;/p>
&lt;pre>&lt;code>git checkout HEAD
&lt;/code>&lt;/pre>&lt;p>Corrects &lt;code>loot.txt&lt;/code>:&lt;/p>
&lt;pre>&lt;code>Pieces of Eight: 600
Gold Bars: 30
Jewelled Necklaces: 20
Diamonds: 10
&lt;/code>&lt;/pre>&lt;p>And then amends the previous commit:&lt;/p>
&lt;pre>&lt;code>git add loot.txt
git commit --amend -m &amp;quot;Plunder from the Spanish galleon&amp;quot;
&lt;/code>&lt;/pre>&lt;p>Now the git history shows the correct values:&lt;/p>
&lt;pre>&lt;code>commit abcdefg
Author: First Mate Morgan &amp;lt;morgan@pirate.net&amp;gt;
Date: Sat Jul 8 12:00:00 2023
Plunder from the Spanish galleon.
commit 1234567
Author: Captain Gitbeard &amp;lt;Gitbeard@pirate.net&amp;gt;
Date: Fri Jul 7 10:00:00 2023
Initial loot list.
&lt;/code>&lt;/pre>&lt;h2 id="the-tale-of-the-missing-loot">The Tale of the Missing Loot&lt;/h2>
&lt;p>During an audit by Quartermaster Anne, she notices the &lt;code>loot.txt&lt;/code> file doesn&amp;rsquo;t list their cache of rum. As she tries to insert this into the initial inventory, she realizes she can&amp;rsquo;t simply amend the commit as it would rewrite everyone&amp;rsquo;s history after that commit.&lt;/p>
&lt;p>To remedy this, she decides to use the interactive rebase to modify the initial commit. She runs:&lt;/p>
&lt;pre>&lt;code>git rebase -i --root
&lt;/code>&lt;/pre>&lt;p>In the text editor that opens up, she changes the word &amp;lsquo;pick&amp;rsquo; to &amp;lsquo;edit&amp;rsquo; for the initial commit, then saves and exits. Git now pauses at the commit she wants to edit.&lt;/p>
&lt;p>She updates &lt;code>loot.txt&lt;/code> to:&lt;/p>
&lt;pre>&lt;code>Pieces of Eight: 500
Gold Bars: 20
Jewelled Necklaces: 15
Diamonds: 7
Rum: 100 barrels
&lt;/code>&lt;/pre>&lt;p>Then, she stages the changes and commits them with:&lt;/p>
&lt;pre>&lt;code>git add loot.txt
git commit --amend -m &amp;quot;Initial loot list.&amp;quot;
&lt;/code>&lt;/pre>&lt;p>To continue the rebase, she runs:&lt;/p>
&lt;pre>&lt;code>git rebase --continue
&lt;/code>&lt;/pre>&lt;p>The &lt;code>loot.txt&lt;/code> file is corrected, and the git history remains consistent for all crew members.&lt;/p>
&lt;h2 id="the-end">The End&lt;/h2>
&lt;p>The &amp;ldquo;Digital Marauder&amp;rdquo; continues to sail through the digital seas, correcting and updating their loot list with each new raid. The crew finds that despite their tipsiness, git gives them the power to make their mistakes disappear - as if they&amp;rsquo;d never happened.&lt;/p></content></item><item><title>All about type hinting in Python</title><link>https://www.robert-sokolewicz.nl/posts/9_typehinting/</link><pubDate>Sun, 18 Jun 2023 00:00:00 +0000</pubDate><guid>https://www.robert-sokolewicz.nl/posts/9_typehinting/</guid><description>What is Type Hinting? Type hinting is a feature introduced in Python 3.5 that allows you to annotate the types of variables, function arguments, and return values. It provides optional typing to the Python language without actually enforcing the types at runtime.
Type hints are used to indicate the expected types of variables and functions, making your code more explicit and self-documenting. They help you catch potential type-related errors early and improve code development and maintainability.</description><content>&lt;h3 id="what-is-type-hinting">What is Type Hinting?&lt;/h3>
&lt;p>Type hinting is a feature introduced in Python 3.5 that allows you to annotate
the types of variables, function arguments, and return values. It provides
optional typing to the Python language without actually enforcing the
types at runtime.&lt;/p>
&lt;p>Type hints are used to indicate the expected types of variables and functions,
making your code more explicit and self-documenting. They help you catch
potential type-related errors early and improve code development and
maintainability.&lt;/p>
&lt;h3 id="why-is-type-hinting-useful">Why is Type Hinting Useful?&lt;/h3>
&lt;p>Type hinting offers several benefits:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>Improved Code Readability&lt;/strong>: Type hints make the code more self-explanatory
by explicitly stating the expected types. It helps other developers
understand your code more easily.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Early Detection of Errors&lt;/strong>: Type hints allow static analysis tools to
catch type-related errors before your code runs. This helps identify
potential bugs and allows you to fix them early in the development process.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Enhanced IDE Support&lt;/strong>: Many integrated development environments (IDEs) can
use type hints to provide better code suggestions, autocompletion, and error
detection while you write your code. This can significantly boost your
productivity.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Documentation and Design Clarity&lt;/strong>: Type hints act as documentation for
your code, making it clear what types are expected and returned by functions.
They help in designing clean interfaces and APIs.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>I find the third point the most useful. If, for example, you&amp;rsquo;re building a data
processing pipeline, and are writing the data preprocessing method, type hinting
allows you to tell your IDE that you are working with a &lt;code>pandas.DataFrame&lt;/code> and in
return, you get all the code suggestions and autocompletion for free.&lt;/p>
&lt;h3 id="type-hinting-examples">Type Hinting Examples&lt;/h3>
&lt;p>Let&amp;rsquo;s look at some examples of how type hinting can improve your code development:&lt;/p>
&lt;h4 id="1-annotating-variable-types">1. Annotating Variable Types:&lt;/h4>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># Without Type Hinting&lt;/span>
name &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;John Doe&amp;#39;&lt;/span>
age &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">30&lt;/span>
balance &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">100.5&lt;/span>
&lt;span style="color:#75715e"># With Type Hinting&lt;/span>
name: str &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;John Doe&amp;#39;&lt;/span>
age: int &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">30&lt;/span>
balance: float &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">100.5&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>By adding type hints to variables, you make it clear what types they should
hold, making the code more readable.&lt;/p>
&lt;h4 id="2-specifying-function-argument-and-return-types">2. Specifying Function Argument and Return Types:&lt;/h4>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">multiply&lt;/span>(a: int, b: int) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> int:
&lt;span style="color:#66d9ef">return&lt;/span> a &lt;span style="color:#f92672">*&lt;/span> b
&lt;/code>&lt;/pre>&lt;/div>&lt;p>In the above example, the &lt;code>multiply&lt;/code> function takes two integer arguments and
returns an integer. The type hints help convey the expected types, enabling
better understanding and potential error detection.&lt;/p>
&lt;h4 id="3-annotating-complex-data-structures">3. Annotating Complex Data Structures:&lt;/h4>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">from&lt;/span> typing &lt;span style="color:#f92672">import&lt;/span> List, Tuple
&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">process_data&lt;/span>(data: List[Tuple[str, int]]) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> List[str]:
result &lt;span style="color:#f92672">=&lt;/span> []
&lt;span style="color:#66d9ef">for&lt;/span> name, age &lt;span style="color:#f92672">in&lt;/span> data:
result&lt;span style="color:#f92672">.&lt;/span>append(f&lt;span style="color:#e6db74">&amp;#39;{name} is {age} years old.&amp;#39;&lt;/span>)
&lt;span style="color:#66d9ef">return&lt;/span> result
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Here, the &lt;code>process_data&lt;/code> function expects a list of tuples, where the first
element is a string and the second element is an integer. It returns a list of
strings. The type hints provide clarity on the data structure, enabling better
understanding and reducing errors.&lt;/p>
&lt;h4 id="4-handling-union-and-optional-types">4. Handling Union and Optional Types:&lt;/h4>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">from&lt;/span> typing &lt;span style="color:#f92672">import&lt;/span> Union, Optional
&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">greet&lt;/span>(name: Union[str, None]) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> Optional[str]:
&lt;span style="color:#66d9ef">if&lt;/span> name &lt;span style="color:#f92672">is&lt;/span> None:
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#e6db74">&amp;#39;Hello!&amp;#39;&lt;/span>
&lt;span style="color:#66d9ef">else&lt;/span>:
&lt;span style="color:#66d9ef">return&lt;/span> f&lt;span style="color:#e6db74">&amp;#39;Hello, {name}!&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>In this example, the &lt;code>greet&lt;/code> function can accept either a string or &lt;code>None&lt;/code> as
the &lt;code>name&lt;/code> argument. It returns an optional string, which means it can return
either a string or &lt;code>None&lt;/code>. Type hints allow you to express such scenarios
accurately.&lt;/p>
&lt;h3 id="conclusion">Conclusion&lt;/h3>
&lt;p>Type hinting in Python is a powerful feature that enhances code readability,
improves error detection, and provides better development tooling support. By
explicitly stating the expected types, you can make your code more
understandable, maintainable, and robust.&lt;/p></content></item><item><title>Getting rid of 'fatal: The current branch &lt;new branch> has no upstream branch' in git</title><link>https://www.robert-sokolewicz.nl/posts/8_git_upstream/</link><pubDate>Mon, 12 Jun 2023 00:00:00 +0000</pubDate><guid>https://www.robert-sokolewicz.nl/posts/8_git_upstream/</guid><description>What is an upstream branch? In Git, an upstream branch refers to the branch in a remote repository that your local branch is associated with or tracks. It serves as a reference point for your local branch and determines where your changes will be pushed when you use the git push command.
When you clone a repository, Git sets up a default upstream branch for the branch you&amp;rsquo;re currently on. For example, if you clone a repository and checkout the master branch, your local master branch will typically have an upstream branch called origin/master, where origin is the default name for the remote repository.</description><content>&lt;h1 id="what-is-an-upstream-branch">What is an upstream branch?&lt;/h1>
&lt;p>In Git, an upstream branch refers to the branch in a remote repository that your local branch is associated with or tracks. It serves as a reference point for your local branch and determines where your changes will be pushed when you use the &lt;code>git push&lt;/code> command.&lt;/p>
&lt;p>When you clone a repository, Git sets up a default upstream branch for the branch you&amp;rsquo;re currently on. For example, if you clone a repository and checkout the &lt;code>master&lt;/code> branch, your local &lt;code>master&lt;/code> branch will typically have an upstream branch called &lt;code>origin/master&lt;/code>, where &lt;code>origin&lt;/code> is the default name for the remote repository.&lt;/p>
&lt;p>Having an upstream branch allows you to easily push and pull changes between your local branch and the corresponding branch in the remote repository. When you push your local changes using &lt;code>git push&lt;/code>, Git knows which remote branch to update based on the upstream branch configuration.&lt;/p>
&lt;p>By default, Git doesn&amp;rsquo;t set an upstream branch when you create a new branch locally. You need to explicitly set the upstream branch using the &lt;code>--set-upstream&lt;/code> option when pushing for the first time, like this:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">git push --set-upstream origin your-branch
&lt;/code>&lt;/pre>&lt;/div>&lt;p>or using the &lt;code>-u&lt;/code> flag&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">git push -u origin your-branch
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Setting the upstream branch allows you to use &lt;code>git push&lt;/code> without specifying the remote branch name every time, as Git will remember the association between your local branch and its upstream branch.&lt;/p>
&lt;h1 id="how-to-automatically-set-the-upstream-branch">How to automatically set the upstream branch&lt;/h1>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">git config --global push.default simple
&lt;/code>&lt;/pre>&lt;/div>&lt;p>To avoid setting upstream explicitly every time you push a new branch, you can configure Git with the push.default option. This option determines the behavior when pushing branches that do not have a configured upstream branch. Here are the possible values for push.default:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>nothing: This is the default option. Git won&amp;rsquo;t push any branch without an upstream branch explicitly specified.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>current: Git pushes the current branch to a branch of the same name on the remote repository, even if it doesn&amp;rsquo;t have an upstream branch.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>upstream: Git pushes the current branch to its upstream branch, if it has one.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>simple: This option is recommended. Git pushes the current branch to its upstream branch if it exists. If the upstream branch doesn&amp;rsquo;t exist, it will push to a branch of the same name on the remote repository, creating a new branch if necessary. However, it won&amp;rsquo;t push if the upstream branch&amp;rsquo;s name is different.&lt;/p>
&lt;/li>
&lt;/ul></content></item><item><title>Mocking context managers with pytest</title><link>https://www.robert-sokolewicz.nl/posts/7_mock_context_manager/</link><pubDate>Thu, 01 Jun 2023 00:00:00 +0000</pubDate><guid>https://www.robert-sokolewicz.nl/posts/7_mock_context_manager/</guid><description>In software testing, it is often necessary to mock external dependencies, such as API calls, to isolate the code under test and simulate specific behaviors. pytest, a popular testing framework in Python, provides powerful mocking capabilities through its pytest-mock plugin. Mocking functions and methods is not so hard, but mocking context managers can be tricky, as sometimes you will need to mock the __enter__() as well.
Example 1 Suppose we have</description><content>&lt;p>In software testing, it is often necessary to mock external dependencies, such as API calls, to isolate the code under test and simulate specific behaviors. &lt;code>pytest&lt;/code>, a popular testing framework in Python, provides powerful mocking capabilities through its &lt;code>pytest-mock&lt;/code> plugin. Mocking functions and methods is not so hard, but mocking context managers can be tricky, as sometimes you will need to mock the &lt;code>__enter__()&lt;/code> as well.&lt;/p>
&lt;h1 id="example-1">Example 1&lt;/h1>
&lt;p>Suppose we have&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">fetch_data&lt;/span>():
response &lt;span style="color:#f92672">=&lt;/span> requests&lt;span style="color:#f92672">.&lt;/span>get(&lt;span style="color:#e6db74">&amp;#34;https://api.example.com/data&amp;#34;&lt;/span>)
&lt;span style="color:#66d9ef">return&lt;/span> response&lt;span style="color:#f92672">.&lt;/span>json()
&lt;/code>&lt;/pre>&lt;/div>&lt;p>which issues an HTTP GET request to &lt;a href="https://api.example.com/data">https://api.example.com/data&lt;/a> and returns whatever the response is in a json format.&lt;/p>
&lt;p>A unit test for this function could look like&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">test_fetch_data&lt;/span>():
&lt;span style="color:#66d9ef">with&lt;/span> mock&lt;span style="color:#f92672">.&lt;/span>patch(&lt;span style="color:#e6db74">&amp;#34;requests.get&amp;#34;&lt;/span>) &lt;span style="color:#66d9ef">as&lt;/span> mock_get:
&lt;span style="color:#75715e"># Set up the desired behavior for the mocked function&lt;/span>
mock_get&lt;span style="color:#f92672">.&lt;/span>return_value&lt;span style="color:#f92672">.&lt;/span>json&lt;span style="color:#f92672">.&lt;/span>return_value &lt;span style="color:#f92672">=&lt;/span> {&lt;span style="color:#e6db74">&amp;#34;message&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;Mocked data&amp;#34;&lt;/span>}
&lt;span style="color:#75715e"># Call the function under test&lt;/span>
result &lt;span style="color:#f92672">=&lt;/span> fetch_data()
&lt;span style="color:#75715e"># Assert the expected behavior&lt;/span>
&lt;span style="color:#66d9ef">assert&lt;/span> result &lt;span style="color:#f92672">==&lt;/span> {&lt;span style="color:#e6db74">&amp;#34;message&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;Mocked data&amp;#34;&lt;/span>}
mock_get&lt;span style="color:#f92672">.&lt;/span>assert_called_once_with(&lt;span style="color:#e6db74">&amp;#34;https://api.example.com/data&amp;#34;&lt;/span>)
mock_get&lt;span style="color:#f92672">.&lt;/span>return_value&lt;span style="color:#f92672">.&lt;/span>json&lt;span style="color:#f92672">.&lt;/span>assert_called_once()
&lt;/code>&lt;/pre>&lt;/div>&lt;p>where we mock the &lt;code>requests.get&lt;/code> function directly. In the &lt;code>fetch_data&lt;/code> function we are returning &lt;code>response.json()&lt;/code> that we would also like to mock with some dummy return data. By chaining &lt;code>mock_get.return_value&lt;/code> together with &lt;code>json.return_value&lt;/code> we can assign the return value of &lt;code>response.json()&lt;/code>.&lt;/p>
&lt;p>One benefit of mockers is that is easy to assert how a method was called, and even how often it was called. In this case, we used&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># Assert the expected behavior&lt;/span>
&lt;span style="color:#66d9ef">assert&lt;/span> result &lt;span style="color:#f92672">==&lt;/span> {&lt;span style="color:#e6db74">&amp;#34;message&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;Mocked data&amp;#34;&lt;/span>}
mock_get&lt;span style="color:#f92672">.&lt;/span>assert_called_once_with(&lt;span style="color:#e6db74">&amp;#34;https://api.example.com/data&amp;#34;&lt;/span>)
mock_get&lt;span style="color:#f92672">.&lt;/span>return_value&lt;span style="color:#f92672">.&lt;/span>json&lt;span style="color:#f92672">.&lt;/span>assert_called_once()
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Things become a little tricky in the next example&lt;/p>
&lt;h1 id="example-2">Example 2&lt;/h1>
&lt;p>&lt;code>requests.get()&lt;/code> returns a &lt;code>Request&lt;/code> object that is a context manager. So often in code we will see the following example instead.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">fetch_data&lt;/span>():
&lt;span style="color:#66d9ef">with&lt;/span> requests&lt;span style="color:#f92672">.&lt;/span>get(&lt;span style="color:#e6db74">&amp;#34;https://api.example.com/data&amp;#34;&lt;/span>) &lt;span style="color:#66d9ef">as&lt;/span> response:
&lt;span style="color:#66d9ef">return&lt;/span> response&lt;span style="color:#f92672">.&lt;/span>json()
&lt;/code>&lt;/pre>&lt;/div>&lt;p>and running the above test on this function instead, will give us a nice warning:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python"> &lt;span style="color:#75715e"># Assert the expected behavior&lt;/span>
&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#66d9ef">assert&lt;/span> result &lt;span style="color:#f92672">==&lt;/span> {&lt;span style="color:#e6db74">&amp;#34;message&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;Mocked data&amp;#34;&lt;/span>}
E &lt;span style="color:#a6e22e">AssertionError&lt;/span>: &lt;span style="color:#66d9ef">assert&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>MagicMock name&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;get().__enter__().json()&amp;#39;&lt;/span> id&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;140616315269184&amp;#39;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">==&lt;/span> {&lt;span style="color:#e6db74">&amp;#39;message&amp;#39;&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;Mocked data&amp;#39;&lt;/span>}
E Full diff:
E &lt;span style="color:#f92672">-&lt;/span> {&lt;span style="color:#e6db74">&amp;#39;message&amp;#39;&lt;/span>: &lt;span style="color:#e6db74">&amp;#39;Mocked data&amp;#39;&lt;/span>}
E &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>MagicMock name&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;get().__enter__().json()&amp;#39;&lt;/span> id&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;140616315269184&amp;#39;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>The error already gives us a hint that we need to mock &lt;code>__enter__&lt;/code> as well. Whereas before &lt;code>response&lt;/code> was the actual &lt;code>Response&lt;/code> object, now it corresponds to whatever &lt;code>Response.__enter__&lt;/code> returns.&lt;/p>
&lt;p>and so, the modified test will look like&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">test_fetch_data&lt;/span>():
&lt;span style="color:#66d9ef">with&lt;/span> mock&lt;span style="color:#f92672">.&lt;/span>patch(&lt;span style="color:#e6db74">&amp;#34;requests.get&amp;#34;&lt;/span>) &lt;span style="color:#66d9ef">as&lt;/span> mock_get:
mock_response &lt;span style="color:#f92672">=&lt;/span> mock&lt;span style="color:#f92672">.&lt;/span>Mock()
mock_response&lt;span style="color:#f92672">.&lt;/span>json&lt;span style="color:#f92672">.&lt;/span>return_value &lt;span style="color:#f92672">=&lt;/span> {&lt;span style="color:#e6db74">&amp;#34;message&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;Mocked data&amp;#34;&lt;/span>}
mock_get&lt;span style="color:#f92672">.&lt;/span>return_value&lt;span style="color:#f92672">.&lt;/span>__enter__&lt;span style="color:#f92672">.&lt;/span>return_value &lt;span style="color:#f92672">=&lt;/span> mock_response
&lt;span style="color:#75715e"># Call the function under test&lt;/span>
result &lt;span style="color:#f92672">=&lt;/span> fetch_data()
&lt;span style="color:#75715e"># Assert the expected behavior&lt;/span>
&lt;span style="color:#66d9ef">assert&lt;/span> result &lt;span style="color:#f92672">==&lt;/span> {&lt;span style="color:#e6db74">&amp;#34;message&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;Mocked data&amp;#34;&lt;/span>}
mock_get&lt;span style="color:#f92672">.&lt;/span>assert_called_once_with(&lt;span style="color:#e6db74">&amp;#34;https://api.example.com/data&amp;#34;&lt;/span>)
mock_response&lt;span style="color:#f92672">.&lt;/span>json&lt;span style="color:#f92672">.&lt;/span>assert_called_once()
&lt;/code>&lt;/pre>&lt;/div>&lt;p>with two small modifications:&lt;/p>
&lt;ul>
&lt;li>We also create a mock response object &lt;code>mock_response&lt;/code> using &lt;code>mock.Mock()&lt;/code> to simulate the behavior of the response.&lt;/li>
&lt;li>We then set up the desired behavior of the context manager by assigning mock_response to &lt;code>mock_get.return_value.__enter__.return_value&lt;/code>. This ensures that when the context manager is entered, our &lt;code>mock_response&lt;/code> object is used.&lt;/li>
&lt;/ul></content></item><item><title>Easy data-scraping using REST API and request package</title><link>https://www.robert-sokolewicz.nl/posts/6_rest_api/</link><pubDate>Mon, 10 Apr 2023 00:00:00 +0000</pubDate><guid>https://www.robert-sokolewicz.nl/posts/6_rest_api/</guid><description>Often when webpages provide a friendly interface to download data, the data itself is fetched using a REST API. Most web browsers can easily intercept the request, which you can modify and edit. This is convenient if you want to use Python to download a lot of data, or if you want to set up an automated data download pipeline.
Here&amp;rsquo;s a quick step-by-step guide on how to do so.</description><content>&lt;p>Often when webpages provide a friendly interface to download data, the data itself is fetched using a REST API. Most web browsers can easily intercept the request, which you can modify and edit. This is convenient if you want to use Python to download a lot of data, or if you want to set up an automated data download pipeline.&lt;/p>
&lt;p>Here&amp;rsquo;s a quick step-by-step guide on how to do so.&lt;/p>
&lt;h2 id="step-1-inspect-the-web-page">Step 1: Inspect the Web Page&lt;/h2>
&lt;p>Open your web browser and navigate to the website from which you want to download data. For this example, I use &lt;a href="https://daggegevens.knmi.nl/klimatologie/daggegevens">weather data&lt;/a> from the Dutch Royal Weather Institute (KNMI).
Right-click on the web page and select &amp;ldquo;Inspect&amp;rdquo; or &amp;ldquo;Inspect Element&amp;rdquo; from the context menu. This will open the browser&amp;rsquo;s developer tools.&lt;/p>
&lt;p>&lt;img src="images/image-4.png" alt="image-4">&lt;/p>
&lt;p>In the developer tools, go to the &amp;ldquo;Network&amp;rdquo; tab. This tab allows you to monitor the network activity of the web page, including the REST API requests and responses.&lt;/p>
&lt;p>&lt;img src="images/image-5.png" alt="image-5">&lt;/p>
&lt;h2 id="step-2-identify-the-rest-api-endpoint">Step 2: Identify the REST API Endpoint&lt;/h2>
&lt;p>Interact with the web page to trigger the REST API request that fetches the data you want to download. In the KNMI data example, we can enter:&lt;/p>
&lt;ul>
&lt;li>Period: 20230101 - 20230410&lt;/li>
&lt;li>Fields: TG (daily mean temperature)&lt;/li>
&lt;li>Weather stations: 260 de Bilt&lt;/li>
&lt;/ul>
&lt;p>and press &amp;ldquo;Bestand downloaden&amp;rdquo;. Most webpages should have either a similar download button or a search query.&lt;/p>
&lt;p>In the &amp;ldquo;Network&amp;rdquo; tab, you should see a list of network requests made by the web page. Look for the REST API request that corresponds to the data you want to download. The REST API request will usually have a URL, method (e.g., GET, POST), and request/response headers. In this example, we look at &amp;ldquo;daggegevens&amp;rdquo;.&lt;/p>
&lt;p>&lt;img src="images/image-6.png" alt="image-6">&lt;/p>
&lt;h2 id="step-3-download-the-rest-api-request-as-curl">Step 3: Download the REST API Request as cURL&lt;/h2>
&lt;p>Right-click the REST API request that you want to download and select &amp;ldquo;Copy&amp;rdquo; &amp;gt; &amp;ldquo;Copy all as cURL&amp;rdquo; from the context menu. This will copy the cURL command that represents the REST API request to your clipboard.&lt;/p>
&lt;p>&lt;img src="images/image-7.png" alt="image-7">&lt;/p>
&lt;p>Open a text editor or a terminal window, and paste the copied cURL command.
Modify the cURL command as needed, such as replacing placeholders with actual values. For example, you may need to update query parameters, request headers, or authentication tokens.
Once you have configured the cURL command, you can execute it in your terminal to download the data from the REST API endpoint. The downloaded data will typically be saved as a response body in the format specified by the REST API (e.g., JSON, XML, CSV).&lt;/p>
&lt;h2 id="step-4-write-a-python-script-for-automated-download">Step 4: Write a Python script for automated download&lt;/h2>
&lt;p>Instead of manually modifying the cURL command and running it from the terminal, it is convenient to do this in Python. This will allow us to automatically sweep through parameters and download everything that we need.&lt;/p>
&lt;p>We first convert the cURL request that is sitting in our clipboard, to a Python script that will use the requests package. A convenient webpage is &lt;a href="https://curlconverter.com/python/">curlconverter.com/python/&lt;/a>.&lt;/p>
&lt;p>&lt;img src="images/image-8.png" alt="image-8">&lt;/p>
&lt;p>You should have a script that is similar to&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> requests
cookies &lt;span style="color:#f92672">=&lt;/span> {
&lt;span style="color:#f92672">...&lt;/span>
}
headers &lt;span style="color:#f92672">=&lt;/span> {
&lt;span style="color:#f92672">...&lt;/span>
}
data &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;...&amp;#39;&lt;/span>
response &lt;span style="color:#f92672">=&lt;/span> requests&lt;span style="color:#f92672">.&lt;/span>post(&lt;span style="color:#e6db74">&amp;#39;...&amp;#39;&lt;/span>, cookies&lt;span style="color:#f92672">=&lt;/span>cookies, headers&lt;span style="color:#f92672">=&lt;/span>headers, data&lt;span style="color:#f92672">=&lt;/span>data)
&lt;/code>&lt;/pre>&lt;/div>&lt;p>In the example of the KNMI weather data, a single download is limited to about 2 years of data. If we want to build a dataset that contains full historical data, we can loop over all the years that we are interested in, where we iteratively run &lt;code>requests.post(...)&lt;/code> but for the correct years and append it to a larger Pandas &lt;code>DataFrame&lt;/code>. Inside the large data string we find &lt;code>name=&amp;quot;start&amp;quot;\r\n\r\n20230101\r\n&lt;/code> and &lt;code>name=&amp;quot;end&amp;quot;\r\n\r\n20230410\r\n&lt;/code>, so we insert variables here over which we can loop:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">data &lt;span style="color:#f92672">=&lt;/span> f&lt;span style="color:#e6db74">&amp;#39;... name=&amp;#34;start&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\r\n\r\n&lt;/span>&lt;span style="color:#e6db74">{year}0101&lt;/span>&lt;span style="color:#ae81ff">\r\n&lt;/span>&lt;span style="color:#e6db74"> ... name=&amp;#34;end&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\r\n\r\n&lt;/span>&lt;span style="color:#e6db74">{year+2}1231&lt;/span>&lt;span style="color:#ae81ff">\r\n&lt;/span>&lt;span style="color:#e6db74"> ...&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>and the looping script will look as:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> pandas &lt;span style="color:#f92672">as&lt;/span> pd
&lt;span style="color:#f92672">from&lt;/span> tqdm &lt;span style="color:#f92672">import&lt;/span> tqdm
&lt;span style="color:#f92672">from&lt;/span> io &lt;span style="color:#f92672">import&lt;/span> BytesIO
&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">get_data&lt;/span>(year):
data &lt;span style="color:#f92672">=&lt;/span> f&lt;span style="color:#e6db74">&amp;#39;... name=&amp;#34;start&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\r\n\r\n&lt;/span>&lt;span style="color:#e6db74">{year}0101&lt;/span>&lt;span style="color:#ae81ff">\r\n&lt;/span>&lt;span style="color:#e6db74"> ... name=&amp;#34;end&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\r\n\r\n&lt;/span>&lt;span style="color:#e6db74">{year+2}1231&lt;/span>&lt;span style="color:#ae81ff">\r\n&lt;/span>&lt;span style="color:#e6db74"> ...&amp;#39;&lt;/span>
&lt;span style="color:#66d9ef">return&lt;/span> data
&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">get_chunked_df&lt;/span>(year):
data &lt;span style="color:#f92672">=&lt;/span> get_data(year)
response &lt;span style="color:#f92672">=&lt;/span> requests&lt;span style="color:#f92672">.&lt;/span>post(
&lt;span style="color:#e6db74">&amp;#34;https://daggegevens.knmi.nl/klimatologie/daggegevens&amp;#34;&lt;/span>,
cookies&lt;span style="color:#f92672">=&lt;/span>cookies,
headers&lt;span style="color:#f92672">=&lt;/span>headers,
data&lt;span style="color:#f92672">=&lt;/span>data,
)
&lt;span style="color:#66d9ef">if&lt;/span> response&lt;span style="color:#f92672">.&lt;/span>status_code &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span>:
content &lt;span style="color:#f92672">=&lt;/span> response&lt;span style="color:#f92672">.&lt;/span>content
&lt;span style="color:#66d9ef">return&lt;/span> pd&lt;span style="color:#f92672">.&lt;/span>read_csv(BytesIO(content), skiprows&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">60&lt;/span>)
&lt;span style="color:#66d9ef">else&lt;/span>:
&lt;span style="color:#66d9ef">return&lt;/span> None
&lt;span style="color:#66d9ef">for&lt;/span> year &lt;span style="color:#f92672">in&lt;/span> tqdm(range(&lt;span style="color:#ae81ff">1900&lt;/span>, &lt;span style="color:#ae81ff">2022&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>)):
df_chunk &lt;span style="color:#f92672">=&lt;/span> get_chunked_df(year)
df &lt;span style="color:#f92672">=&lt;/span> pd&lt;span style="color:#f92672">.&lt;/span>concat([df, df_chunk])
df&lt;span style="color:#f92672">.&lt;/span>to_csv(&lt;span style="color:#e6db74">&amp;#34;data/weather.csv&amp;#34;&lt;/span>, index&lt;span style="color:#f92672">=&lt;/span>False)
&lt;/code>&lt;/pre>&lt;/div>&lt;p>some notes about this code:&lt;/p>
&lt;ul>
&lt;li>an HTTP request always returns a &lt;code>status_code&lt;/code>. &lt;code>200&lt;/code> means you made a successful request and any other code indicates that something went wrong (e.g. &lt;code>403&lt;/code> - access denied).&lt;/li>
&lt;li>&lt;code>response.content&lt;/code> returns a &lt;em>byte stream&lt;/em> that contains the content of the &lt;code>.csv&lt;/code> file that we requested. This can be passed directly to &lt;code>pandas.read_csv&lt;/code> using &lt;code>io.BytesIO&lt;/code>, so no need to save the file to disk first.&lt;/li>
&lt;li>we pass the argument &lt;code>skiprows=60&lt;/code> to &lt;code>.read_csv(...)&lt;/code> because the KNMI data contains 60 rows of comments with explanations of what each data field means. The actual data that we are interested in starts from line &lt;code>61&lt;/code>.&lt;/li>
&lt;/ul>
&lt;p>That&amp;rsquo;s it! We have now successfully downloaded data from a website using REST API by inspecting the web page, identifying the REST API endpoint, and downloading the REST API request as cURL. Remember to always review and follow the terms of use and policies of the website and REST API you are accessing, and be respectful of any usage limits or restrictions. Frequent and bulky downloads are not always appreciated and you might get a temporary IP ban if you overuse the API endpoint.&lt;/p></content></item><item><title>Some tips for using VS code for python development</title><link>https://www.robert-sokolewicz.nl/posts/3_vs_code_tips/</link><pubDate>Mon, 10 Apr 2023 00:00:00 +0000</pubDate><guid>https://www.robert-sokolewicz.nl/posts/3_vs_code_tips/</guid><description>Useful Shortcuts Moving lines up/down shortcut: alt + up-arrow/down-arrow
Add cursors to the end of lines of selected code shortcut: alt + shift + i
Add cursor directly up or down shortcut: ctrl + alt + up-arrow/down-arrow
Useful packages Error Lens Adds a nice inline description when something is wrong with your code.
Black formatter Adds black as one of the code formatters in VS Code. A nice tip: turn on the setting format on save.</description><content>&lt;h1 id="useful-shortcuts">Useful Shortcuts&lt;/h1>
&lt;h2 id="moving-lines-updown">Moving lines up/down&lt;/h2>
&lt;p>shortcut: &lt;code>alt + up-arrow/down-arrow&lt;/code>&lt;/p>
&lt;h2 id="add-cursors-to-the-end-of-lines-of-selected-code">Add cursors to the end of lines of selected code&lt;/h2>
&lt;p>shortcut: &lt;code>alt + shift + i&lt;/code>&lt;/p>
&lt;h2 id="add-cursor-directly-up-or-down">Add cursor directly up or down&lt;/h2>
&lt;p>shortcut: &lt;code>ctrl + alt + up-arrow/down-arrow&lt;/code>&lt;/p>
&lt;h1 id="useful-packages">Useful packages&lt;/h1>
&lt;h2 id="error-lens">Error Lens&lt;/h2>
&lt;p>Adds a nice inline description when something is wrong with your code.&lt;/p>
&lt;h2 id="black-formatter">Black formatter&lt;/h2>
&lt;p>Adds black as one of the code formatters in VS Code. A nice tip: turn on the setting &lt;code>format on save&lt;/code>.&lt;/p>
&lt;h2 id="code-spell-checker">Code Spell Checker&lt;/h2>
&lt;p>A neat plug-in that checks the spelling of words in comments and doc-strings, but also checks the spelling of variable names.&lt;/p>
&lt;h2 id="gitlens">GitLens&lt;/h2>
&lt;p>Adds git-blame annotation, shows authors above each class definition and much more git goodness.&lt;/p>
&lt;h2 id="rainbow-csv">Rainbow CSV&lt;/h2>
&lt;p>A cool plug-in that highlights different columns in a &lt;code>.csv&lt;/code> file.&lt;/p>
&lt;h2 id="rewrap">Rewrap&lt;/h2>
&lt;p>Wrapping comments, docstrings and text to 90 character width by just pressing &lt;code>alt+Q&lt;/code>. Ideal when working with ruff and/or black.&lt;/p>
&lt;h2 id="ruff">Ruff&lt;/h2>
&lt;p>The official Ruff plugin for VS-Code. Ruff is a collection of python linters that works extremely fast.&lt;/p>
&lt;h2 id="gitlab-workflow">GitLab Workflow&lt;/h2>
&lt;p>When reviewing other&amp;rsquo;s open merge requests, this plugin lets you explore the merge request from within VS code in a much nicer way than the web browser editor on gitlab.com. It allows you to read the description and comments as well. Placing comments is a bit of a hassle, as it doesn&amp;rsquo;t support &amp;ldquo;reviews&amp;rdquo; where you can submit all comments at once. It also doesn&amp;rsquo;t support code suggestions.&lt;/p>
&lt;h2 id="grammarly">Grammarly&lt;/h2>
&lt;p>Spell and grammar checker for &lt;code>.md&lt;/code> and &lt;code>.txt&lt;/code> files. To check &lt;code>.md&lt;/code> files, you will have to add the following to your Visual Studio Code settings:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json"> &lt;span style="color:#e6db74">&amp;#34;grammarly.files.include&amp;#34;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">:&lt;/span> [
&lt;span style="color:#e6db74">&amp;#34;**/*.txt&amp;#34;&lt;/span>,
&lt;span style="color:#e6db74">&amp;#34;**/*.md&amp;#34;&lt;/span>
]&lt;span style="color:#960050;background-color:#1e0010">,&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>or via the interface:&lt;/p>
&lt;p>&lt;img src="images/image-2.png" alt="image-2">&lt;/p>
&lt;h1 id="other">Other&lt;/h1>
&lt;h2 id="useful-settings">Useful settings&lt;/h2>
&lt;h3 id="copy-paste-images-into-markdown-files">Copy-paste images into markdown files&lt;/h3>
&lt;p>Add these two lines to your Visual Studio Code settings&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json"> &lt;span style="color:#e6db74">&amp;#34;editor.experimental.pasteActions.enabled&amp;#34;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">:&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">,&lt;/span>
&lt;span style="color:#e6db74">&amp;#34;markdown.experimental.copyFiles.destination&amp;#34;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">:&lt;/span> {
&lt;span style="color:#f92672">&amp;#34;**/*&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;images/&amp;#34;&lt;/span>
}&lt;span style="color:#960050;background-color:#1e0010">,&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>or via the interface:&lt;/p>
&lt;p>&lt;img src="images/image-3.png" alt="image">&lt;/p>
&lt;p>and&lt;/p>
&lt;p>&lt;img src="images/image-1.png" alt="image-1">&lt;/p>
&lt;p>This allows you to paste an image directly into a markdown file with &lt;code>ctrl+v / cmd+v&lt;/code>. This inserts the line&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-rst" data-lang="rst">![image](images/image.png)&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>into your document and creates a copy of the image in &lt;code>images/image.png&lt;/code>, where &lt;code>images&lt;/code> is the name of the folder relative to your file. This can be changed in the settings above. If you include multiple images, each image name will be appended by a number, i.e. &lt;code>image-1.png&lt;/code>, &lt;code>image-2.png&lt;/code>, etc.&lt;/p>
&lt;h2 id="editable-installs">Editable installs&lt;/h2>
&lt;p>Sometimes VS Code has problems with auto-completion and finding the definitions of imported symbols when they come from a package that is installed in editable mode, e.g. via &lt;code>pip install -e .&lt;/code>. With recent versions of &lt;code>setuptools&lt;/code> (&amp;gt;=0.64.0), editable installs behave a bit differently and these cause issues. There are three solutions to this:&lt;/p>
&lt;ol>
&lt;li>Downgrade &lt;code>setuptools&lt;/code> (i.e. &lt;code>pip install setuptools&amp;lt;0.64&lt;/code>)&lt;/li>
&lt;li>Instruct pip to use a legacy mode: &lt;code>pip install -e . --config-settings editable_mode=compat&lt;/code>. The developers at &lt;code>setuptools&lt;/code> do &lt;a href="https://setuptools.pypa.io/en/latest/userguide/development_mode.html#legacy-behavior">warn&lt;/a> however that this is only a temporary solution and will likely to be changed and later removed entirely in future versions of &lt;code>setuptools&lt;/code>.&lt;/li>
&lt;li>Add the project to the python path. When testing out new features inside a jupyter notebook it is sufficient to add the line &lt;code>sys.path.insert(1, &amp;quot;path-to-package&amp;quot;)&lt;/code> in the top cell. &lt;code>&amp;quot;path-to-package&amp;quot;&lt;/code> can be either an absolute path (e.g. &lt;code>&amp;quot;/users/rsoko/dev/my-package&amp;quot;&lt;/code>) or a relative path (&lt;code>&amp;quot;my-package&amp;quot;&lt;/code>, &lt;code>&amp;quot;./my-package&amp;quot;&lt;/code> or even &lt;code>&amp;quot;../my-package&amp;quot;&lt;/code>).&lt;/li>
&lt;/ol></content></item><item><title>Managing git ssh-keys for multiple accounts on GitLab and GitHub</title><link>https://www.robert-sokolewicz.nl/posts/4_git_ssh/</link><pubDate>Sun, 04 Dec 2022 00:00:00 +0000</pubDate><guid>https://www.robert-sokolewicz.nl/posts/4_git_ssh/</guid><description>If you only have one account for every git repository provider, for example, one for www.github.com and one for www.gitlab.com, you will need to add the following to your ssh-config file, ~/.ssh/config
host github.com HostName github.com IdentityFile ~/.ssh/github User git host gitlab.com HostName gitlab.com IdentityFile ~/.ssh/gitlab User git where the identity files contain your private key for each account. These can be generated by running
ssh-keygen which will prompt you to specify a location and a passphrase:</description><content>&lt;h1 id="heading">&lt;/h1>
&lt;p>If you only have one account for every git repository provider, for example, one
for &lt;code>www.github.com&lt;/code> and one for &lt;code>www.gitlab.com&lt;/code>, you will need to add the
following to your ssh-config file, &lt;code>~/.ssh/config&lt;/code>&lt;/p>
&lt;pre>&lt;code>host github.com
HostName github.com
IdentityFile ~/.ssh/github
User git
host gitlab.com
HostName gitlab.com
IdentityFile ~/.ssh/gitlab
User git
&lt;/code>&lt;/pre>&lt;p>where the identity files contain your private key for each account. These can be
generated by running&lt;/p>
&lt;pre>&lt;code>ssh-keygen
&lt;/code>&lt;/pre>&lt;p>which will prompt you to specify a location and a passphrase:&lt;/p>
&lt;pre>&lt;code>Generating public/private rsa key pair.
Enter file in which to save the key (/home/rsoko/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
&lt;/code>&lt;/pre>&lt;p>these are all optional, but to work with the above config we need to generate
two keys, one located at &lt;code>~/.ssh/gitlab&lt;/code> and one at &lt;code>~/.ssh/github&lt;/code>. As for the
passphrase, this can be left empty if you don&amp;rsquo;t want to enter a password every
time you create an ssh connection (for example when pushing code to the remote
repository).&lt;/p>
&lt;p>check if everything works:&lt;/p>
&lt;pre>&lt;code>ssh -T git@gitlab.com
&lt;/code>&lt;/pre>&lt;p>which gives me&lt;/p>
&lt;pre>&lt;code>Welcome to GitLab, @rsokolewicz!
&lt;/code>&lt;/pre>&lt;h1 id="multiple-accounts-per-provider">multiple accounts per provider&lt;/h1>
&lt;p>If you have multiple accounts on for example gitlab.com (e.g. one personal and one work),
you can configure the ssh-config as follows&lt;/p>
&lt;pre>&lt;code>host gitlab-private
HostName gitlab.com
IdentityFile ~/.ssh/gitlab_private
User git
host gitlab-work
HostName gitlab.com
IdentityFile ~/.ssh/gitlab_work
User git
&lt;/code>&lt;/pre>&lt;p>and follow the steps as before to generate &lt;code>gitlab_private&lt;/code> and &lt;code>gitlab_work&lt;/code>.
The crucial step now is when setting up the &lt;code>remote-url&lt;/code> of a git repository to
map it to the correct entry in the above ssh configuration:&lt;/p>
&lt;pre>&lt;code>git remote set-url origin git@gitlab-private:repo.git
&lt;/code>&lt;/pre>&lt;p>&lt;code>git@gitlab-private:repo.git&lt;/code> has two important parts: &lt;code>git@...:&lt;/code> and
&lt;code>:....git&lt;/code>. The first part that&amp;rsquo;s between &lt;code>git@...:&lt;/code> corresponds to the name of
the host that is specified in the ssh configuration. In the above case &lt;code>host gitlab-private&lt;/code>. The name can be anything and is there just to map the correct ssh key to the corresponding repo. The second part &lt;code>:...git&lt;/code> is the git-url to the repo.&lt;/p></content></item><item><title>The Query Likelihood Model</title><link>https://www.robert-sokolewicz.nl/posts/2_query_likelihood/</link><pubDate>Mon, 18 Apr 2022 00:00:00 +0000</pubDate><guid>https://www.robert-sokolewicz.nl/posts/2_query_likelihood/</guid><description>Language Models One of the central ideas behind language modeling is that when a user tries to produce a good search query, he or she will come up with terms that are likely to appear in a relevant document. In other words, a relevant document is one that is likely to contain the query terms. What makes language modeling different from other probabilistic models, is that it creates a language model for each document from which probabilities are generated that correspond to the likelihood that a query can be found in that document.</description><content>&lt;h1 id="language-models">Language Models&lt;/h1>
&lt;p>One of the central ideas behind language modeling is that when a user tries to produce a good search query, he or she will come up with terms that are likely to appear in a relevant document. In other words, a relevant document is one that is likely to contain the query terms. What makes language modeling different from other probabilistic models, is that it creates a language model for each document from which probabilities are generated that correspond to the likelihood that a query can be found in that document. This probability is given by $P(q|M_d)$.&lt;/p>
&lt;p>The definition of a language model is a function that produces probabilities for a word or collection of words (e.g. a (part of a) sentence) given a vocabulary. Let us look at an example of a model that produces probabilities for single words:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>s&lt;/th>
&lt;th>cat&lt;/th>
&lt;th>dog&lt;/th>
&lt;th>likes&lt;/th>
&lt;th>fish&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>$P(s)$&lt;/td>
&lt;td>0.3&lt;/td>
&lt;td>0.1&lt;/td>
&lt;td>0.2&lt;/td>
&lt;td>0.2&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>The probability for the sentence &amp;ldquo;cat likes fish&amp;rdquo; is $0.3\times0.2\times0.2 = 0.012$, whereas the probability for the sentence &amp;ldquo;dog likes cat&amp;rdquo; is $0.1\times0.2\times0.3 = 0.006$. This means that the term &amp;ldquo;cat likes fish&amp;rdquo; is more likely to appear in the document than &amp;ldquo;dog likes cat&amp;rdquo;. If we want to compare different documents with the same search query, we produce the probability for each document separately. Remember that each document has its own language model with different probabilities.&lt;/p>
&lt;p>Another way of interpreting these probabilities is asking how likely it is that this model generates the sentence &amp;ldquo;cat likes fish&amp;rdquo; or &amp;ldquo;dog likes cat&amp;rdquo;. (Technically speaking you should also include probabilities how likely it is that a sentence continues or stops after each word). These sentences don&amp;rsquo;t have to exist in the document, nor do they have to make sense. In this language model for example, the sentences &amp;ldquo;cat likes fish&amp;rdquo; and &amp;ldquo;cat fish fish&amp;rdquo; have the same probability, in other words they are equally likely to be generated.&lt;/p>
&lt;p>The language model from the example above is called a unigram language model, it is a model that estimates each term independently and ignores the context. One language model that does include context is the bigram language model. This model includes conditional probabilities for terms given that they are preceded by another term. The probability for &amp;ldquo;cat likes fish&amp;rdquo; would be given by&lt;/p>
&lt;p>$$ P(\text{cat}) \times P(\text{likes}|\text{cat}) \times P(\text{fish}|\text{likes}). $$&lt;/p>
&lt;p>This of course requires all conditional probabilities to exist.&lt;/p>
&lt;p>More complex models exist, but they are less likely to be used. Each document creates a new language model, but the training data within one document is often not sufficiently large enough to accurately train a more complex model. This is reminiscent of the bias-variance trade-off. Complex models have high variance and are prone to overfitting on smaller training data.&lt;/p>
&lt;h1 id="the-query-likelihood-model">The Query Likelihood Model&lt;/h1>
&lt;p>When ranking documents by how relevant they are to a query, we are interested in the conditional probability $P(d|q)$. In the query likelihood model, this probability is so-called rank-equivalent to $P(q|d)$, so that we only need to use the probabilities discussed above. To see why they are rank-equivalent let us look at Bayes Rule:&lt;/p>
&lt;p>$$ P(d|q) = P(q|d) P(d) / P(q) $$&lt;/p>
&lt;p>Since $P(q)$ has the same value for each document, it will not affect the ranking at all. $P(d)$ on the other hand is treated as being uniform for simplicity and so will not affect the ranking either (in more complicated models $P(d)$ could be made dependent on the length of the document for example). And so, the probability $P(d|q)$ is equivalent to $P(q|d)$. In other words, in the query likelihood model the following two statements are &lt;em>rank-equivalent&lt;/em>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>The likelihood that document d is relevant to query q.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>The probability that query q is generated by the language of document d.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>When a user creates a query, he or she already has an idea of how a relevant document could look like. The terms used in the query are more likely to appear in relevant documents than in non-relevant documents.&lt;/p>
&lt;p>One way of estimating the probability $P(q|d)$ for a unigram model is using the maximum likelihood estimation&lt;/p>
&lt;p>$$ P(Q|M_d) = \Pi_{t\in q} P_{\text{mle}}(T|M_d) = \Pi_{t\in q}\frac{\text{tf}_{t,d}}{L_d}$$&lt;/p>
&lt;p>Where $\text{tf}_{t,d}$ is the term frequency of term $t$ in document $d$ and $L_d$ is the size of document $d$. In other words, calculate the fraction of how often each query word appears in document $d$ compared to all words in that document, and then multiply all those fractions with each other.&lt;/p>
&lt;p>There are two small problems with the formula above. First, if one the terms in the query does not appear in a document, the entire probability $P(q|d)$ will be zero. In other words, the only way to get a non-zero probability is if each term in the query appears in the document. The second problem is that the probability of the terms that appear less frequently in the document are likely to be overestimated.&lt;/p>
&lt;p>The solution to these problems is to introduce smoothing. Smoothing will help by creating non-zero probabilities for terms that do not appear in the document, and by creating effective weights to frequent terms. Different smoothing techniques exist such as Jelinek-Mercer smoothing, that uses a linear combination of document-specific and collection-specific maximum likelihood estimations&lt;/p>
&lt;p>$$ P(T|d) = \lambda P_\text{mle} (t|M_d) +(1-\lambda)P_\text{mle}(t|M_c) $$&lt;/p>
&lt;p>where $0&amp;lt;\lambda&amp;lt;1$ is a hyperparameter that can be finetuned and $M_c$ is a language model created on the entire document collection. Another popular smoothing technique is Dirichlet smoothing&lt;/p>
&lt;p>$$ P(t|d) = \frac{\text{tf}_{t,d}+\alpha P(t|M_c)}{L_d + \alpha} $$&lt;/p>
&lt;p>(parts of this article also appear in this &lt;a href="https://medium.com/towards-data-science/understanding-term-based-retrieval-methods-in-information-retrieval-2be5eb3dde9f">Medium post&lt;/a> about term-based retrieval methods in information retrieval I wrote with my gf)&lt;/p></content></item><item><title>Copy large amounts of files over ssh</title><link>https://www.robert-sokolewicz.nl/posts/1_copy_large_amounts_of_files/</link><pubDate>Wed, 13 Apr 2022 00:00:00 +0000</pubDate><guid>https://www.robert-sokolewicz.nl/posts/1_copy_large_amounts_of_files/</guid><description>To copy large amounts of files over ssh you have a few options. The slowest option is using scp -r to recursively copy each file one by one, but it is faster and more convenient to first tar or gzip your home directory, copy it over to your host computer and unpack it there. This is possible to do in a single line
tar czf - &amp;lt;files&amp;gt; | ssh user@host &amp;quot;tar -C &amp;lt;destination&amp;gt; xvzf -&amp;quot; where &amp;lt;files&amp;gt; are paths to the files and directories to tar and &amp;lt;destination&amp;gt; is the destination folder on the host computer.</description><content>&lt;p>To copy large amounts of files over ssh you have a few options. The slowest option is using &lt;code>scp -r&lt;/code> to recursively copy each file one by one, but it is faster and more convenient to first tar or gzip your home directory, copy it over to your host computer and unpack it there. This is possible to do in a single line&lt;/p>
&lt;pre>&lt;code class="language-{bash}" data-lang="{bash}">tar czf - &amp;lt;files&amp;gt; | ssh user@host &amp;quot;tar -C &amp;lt;destination&amp;gt; xvzf -&amp;quot;
&lt;/code>&lt;/pre>&lt;p>where &lt;code>&amp;lt;files&amp;gt;&lt;/code> are paths to the files and directories to tar and &lt;code>&amp;lt;destination&amp;gt;&lt;/code> is the destination folder on the host computer. One downside of this approach is that you won&amp;rsquo;t have a clear indication on how long it will take. An alternative approach is to first tar everything, and then use &lt;code>rsync&lt;/code> to send everything over.&lt;/p>
&lt;pre>&lt;code class="language-{bash}" data-lang="{bash}">tar czf &amp;lt;files&amp;gt;
rsync -av --progress /foo/*.tar.gz user@host:&amp;lt;directory&amp;gt;
```&lt;/code>&lt;/pre></content></item><item><title>How to ssh over WiFi between two machines running wsl</title><link>https://www.robert-sokolewicz.nl/posts/0_ssh_over_wifi_wsl/</link><pubDate>Wed, 16 Feb 2022 00:00:00 +0000</pubDate><guid>https://www.robert-sokolewicz.nl/posts/0_ssh_over_wifi_wsl/</guid><description>We first follow a tutorial by Scott Hanselman where we will use Windows&amp;rsquo; openSSH to handle ssh connections and set the default ssh shell to be bash on wsl.
Setup ssh on your machine Choose one of your two machines to be the host. On the host, we need to first check if OpenSSH.Server is installed. Open powershell with elevated rights and run the following
&amp;gt; Get-WindowsCapability -Online | ? Name -like 'OpenSSH*' Name : OpenSSH.</description><content>&lt;p>We first follow a tutorial by &lt;a href="https://www.hanselman.com/blog/the-easy-way-how-to-ssh-into-bash-and-wsl2-on-windows-10-from-an-external-machine">Scott Hanselman&lt;/a> where we will use Windows&amp;rsquo; openSSH to handle ssh connections and set the default ssh shell to be bash on wsl.&lt;/p>
&lt;h2 id="setup-ssh-on-your-machine">Setup ssh on your machine&lt;/h2>
&lt;p>Choose one of your two machines to be the host. On the host, we need to first check if OpenSSH.Server is installed. Open powershell with elevated rights and run the following&lt;/p>
&lt;pre>&lt;code class="language-{cmd}" data-lang="{cmd}">&amp;gt; Get-WindowsCapability -Online | ? Name -like 'OpenSSH*'
Name : OpenSSH.Client~~~~0.0.1.0
State : Installed
Name : OpenSSH.Server~~~~0.0.1.0
State : NotPresent
&lt;/code>&lt;/pre>&lt;p>If the state under OpenSSH.server is &lt;code>NotPresent&lt;/code>, we need to run&lt;/p>
&lt;pre>&lt;code class="language-{cmd]" data-lang="{cmd]">Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0
&lt;/code>&lt;/pre>&lt;p>and start the ssh daemon&lt;/p>
&lt;pre>&lt;code class="language-{cmd}" data-lang="{cmd}">Start-Service sshd
Get-Service sshd
&lt;/code>&lt;/pre>&lt;p>If you expect to use the Host more often, you can consider starting the ssh daemon automatically on the host&lt;/p>
&lt;pre>&lt;code class="language-{cmd}" data-lang="{cmd}">Set-Service -Name sshd -StartupType 'Automatic'
&lt;/code>&lt;/pre>&lt;p>Next, we will set the default shell used by OpenSSH to be the one used by wsl&lt;/p>
&lt;pre>&lt;code class="language-{cmd}" data-lang="{cmd}">New-ItemProperty -Path &amp;quot;HKLM:\SOFTWARE\OpenSSH&amp;quot; -Name DefaultShell -Value &amp;quot;C:\WINDOWS\System32\bash.exe&amp;quot; -PropertyType String -Force
&lt;/code>&lt;/pre>&lt;h2 id="make-your-machine-discoverable-over-network">Make your machine discoverable over network&lt;/h2>
&lt;p>To be able to find your host machine that runs the ssh daemon, you need to make some configurations in the network settings first. On both machines, go to network settings and under &amp;ldquo;network profile&amp;rdquo;, select &amp;ldquo;private network&amp;rdquo;. This will allow both machines to be discoverable on the WiFi network. If all is well, when you open File Explorer, under Network you should see your two machines. If you don&amp;rsquo;t see it, you might need to restart your computer(s), or temporary turn off Windows firewall.&lt;/p>
&lt;h2 id="preparing-to-copy">Preparing to copy&lt;/h2>
&lt;p>Now that this is all set-up, you should be able to ssh into your host computer via&lt;/p>
&lt;pre>&lt;code class="language-{bash}" data-lang="{bash}">ssh user@host
&lt;/code>&lt;/pre>&lt;p>where &lt;code>user&lt;/code> is your Windows login username (not your wsl linux username), and &lt;code>host&lt;/code> is your host computer&amp;rsquo;s local private ip address that looks like &lt;code>192.168.x.x&lt;/code> or &lt;code>172.x.x.x&lt;/code>. You can get the ip address by either running &lt;code>ifconfig eth0&lt;/code> in your terminal, or by opening your Windows Network Settings (win-key &amp;gt; &amp;ldquo;network settings&amp;rdquo;).&lt;/p>
&lt;p>If you do not manage to connect, make sure the ssh daemon is running on your host computer by running &lt;code>sudo service ssh status&lt;/code>. If it is not running you can start it with &lt;code>sudo service ssh start&lt;/code>. If you still cannot connect, try to open port 22 in your firewall on the host computer, or temporary turn off Windows firewall.&lt;/p>
&lt;p>If all is correct you should get inside your host&amp;rsquo;s wsl partition directly.&lt;/p></content></item><item><title>elements</title><link>https://www.robert-sokolewicz.nl/posts/1_elements/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.robert-sokolewicz.nl/posts/1_elements/</guid><description>Table of contents Table of contents Text Code Python C/C++ Bash Tables Text Some example text
Code Python def foo(): print (&amp;#34;This is a python function&amp;#34;) C/C++ void foo(){ prinf(&amp;#34;%s\n&amp;#34;, &amp;#34;This is a C function&amp;#34;) } Bash # This is a bash command cd dir &amp;amp;&amp;amp; echo $PWD; # Return exit 0; Tables Pages Elements 1 Text 2 Code 3 Tables</description><content>&lt;h2 id="table-of-contents">Table of contents&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="#table-of-contents">Table of contents&lt;/a>&lt;/li>
&lt;li>&lt;a href="#text">Text&lt;/a>&lt;/li>
&lt;li>&lt;a href="#code">Code&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#python">Python&lt;/a>&lt;/li>
&lt;li>&lt;a href="#cc">C/C++&lt;/a>&lt;/li>
&lt;li>&lt;a href="#bash">Bash&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#tables">Tables&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="text">Text&lt;/h2>
&lt;p>Some example text&lt;/p>
&lt;h2 id="code">Code&lt;/h2>
&lt;h3 id="python">Python&lt;/h3>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">foo&lt;/span>():
&lt;span style="color:#66d9ef">print&lt;/span> (&lt;span style="color:#e6db74">&amp;#34;This is a python function&amp;#34;&lt;/span>)
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="cc">C/C++&lt;/h3>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-C" data-lang="C">&lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">foo&lt;/span>(){
prinf(&lt;span style="color:#e6db74">&amp;#34;%s&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;This is a C function&amp;#34;&lt;/span>)
}
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="bash">Bash&lt;/h3>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#75715e"># This is a bash command&lt;/span>
cd dir &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> echo $PWD;
&lt;span style="color:#75715e"># Return&lt;/span>
exit 0;
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="tables">Tables&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Pages&lt;/th>
&lt;th>Elements&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>1&lt;/td>
&lt;td>Text&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&lt;/td>
&lt;td>Code&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>3&lt;/td>
&lt;td>Tables&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></content></item></channel></rss>