<!doctype html><html lang=en><head><title>Using git bisect to find a bug :: Roberts blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Oops, you broke something but don't know when? Use git bisect!"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://www.robert-sokolewicz.nl/posts/20_git_bisect/><link rel=stylesheet href=https://www.robert-sokolewicz.nl/assets/style.css><link rel=stylesheet href=https://www.robert-sokolewicz.nl/assets/css/hugo-cite.css><link rel=apple-touch-icon href=https://www.robert-sokolewicz.nl/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://www.robert-sokolewicz.nl/img/favicon/orange.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Using git bisect to find a bug"><meta property="og:description" content="Oops, you broke something but don't know when? Use git bisect!"><meta property="og:url" content="https://www.robert-sokolewicz.nl/posts/20_git_bisect/"><meta property="og:site_name" content="Roberts blog"><meta property="og:image" content="https://www.robert-sokolewicz.nl"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2024-10-16 00:00:00 +0000 UTC"><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\\[','\\]']],macros:{bb:["{\\boldsymbol{#1}}",1],tr:"{\\DeclareMathOperator{\\tr}{Tr}}",im:"{\\DeclareMathOperator{\\im}{Im}}",re:"{\\DeclareMathOperator{\\re}{Re}}",},processEscapes:true,processEnvironments:true,tags:"ams"},options:{skipHtmlTags:['script','noscript','style','textarea','pre']}};window.addEventListener('load',(event)=>{document.querySelectorAll("mjx-container").forEach(function(x){x.parentElement.classList+='has-jax'})});</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script type=text/x-mathjax-config>
    MathJax.Hub.Queue(function() {
        // Fix <code> tags after MathJax finishes running. This is a
        // hack to overcome a shortcoming of Markdown. Discussion at
        // https://github.com/mojombo/jekyll/issues/199
        var all = MathJax.Hub.getAllJax(), i;
        for(i = 0; i &lt; all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
    </script></head><body class=orange><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Home</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=/books>Book Reviews</a></li><li><a href=/cv>CV</a></li><li><a href=/physics>Physics</a></li><li><a href=/reading_papers>Reading Papers</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=/books>Book Reviews</a></li><li><a href=/cv>CV</a></li><li><a href=/physics>Physics</a></li><li><a href=/reading_papers>Reading Papers</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://www.robert-sokolewicz.nl/posts/20_git_bisect/>Using git bisect to find a bug</a></h1><div class=post-meta><span class=post-date>2024-10-16</span>
<span class=post-author>:: Robert</span></div><div class=post-content><div><h1 id=bisecting-the-git-bisect-command>Bisecting the <code>git bisect</code> command<a href=#bisecting-the-git-bisect-command class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Imagine implementing a feature, while not running any unit tests for a couple of commits. And oops, there&rsquo;s a failing test. Or worse, a user discovers a breaking change but you don&rsquo;t know which commit introduced it.</p><p>With <code>git bisect</code> you can do a quick binary search through your git history to find the commit that introduced the bug. Pretty cool! I find the interface a bit confusing, so here it is. It&rsquo;s basically a bunch of commands:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git bisect start
git bisect bad &lt;commit_hash&gt;
git bisect good &lt;commit_hash&gt;
git run &lt;command&gt;
git bisect reset
</code></pre></div><p>instead of git hashes or tags you can also specify the number of commits from the current state. So if you know that 20 commits ago everything worked, you can do <code>git bisect good HEAD~20</code> and <code>git bisect bad HEAD</code> to start the search. With <code>git run &lt;command></code>, you can specify any command that should return with a non-zero exit code if the current commit is bad. This can be a pytest, e.g.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git bisect run pytest tests/test_foo.py::test_bar
</code></pre></div><p>or any script that you want to run:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git bisect run ./run_tests.sh
</code></pre></div><p>or even</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git bisect run python foo.py
</code></pre></div><p>alternatively, you can also manually inspect/run each commit during the bisection and mark if their good or bad using <code>git bisect good</code> and <code>git bisect bad</code>.</p><p>If you run <code>git bisect run</code> it might output a lot of noise that you don&rsquo;t care about. e.g. with ptyest you&rsquo;ll end up with:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git bisect run pytest tests/test_foo.py::test_bar
running pytest tests/test_foo.py::test_bar
<span style=color:#f92672>=============================</span> test session starts <span style=color:#f92672>==============================</span>
platform linux -- Python 3.12.10, pytest-8.3.3
rootdir: /home/user/project
collected <span style=color:#ae81ff>1</span> item

tests/test_foo.py F                                                     <span style=color:#f92672>[</span>100%<span style=color:#f92672>]</span>

<span style=color:#f92672>==================================</span> FAILURES <span style=color:#f92672>===================================</span>
__________________________________ test_bar __________________________________

    def test_bar<span style=color:#f92672>()</span>:
&gt;       assert foo.bar<span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>42</span>
E       AssertionError: assert 41 <span style=color:#f92672>==</span> <span style=color:#ae81ff>42</span>
E        +  where 41 <span style=color:#f92672>=</span> &lt;<span style=color:#66d9ef>function</span> bar at 0x7f9b1c3e6f70&gt;<span style=color:#f92672>()</span>
E        +    where &lt;<span style=color:#66d9ef>function</span> bar at 0x7f9b1c3e6f70&gt; <span style=color:#f92672>=</span> foo.bar

tests/test_foo.py:8: AssertionError
<span style=color:#f92672>===========================</span> short test summary info <span style=color:#f92672>===========================</span>
FAILED tests/test_foo.py::test_bar - AssertionError: assert 41 <span style=color:#f92672>==</span> 42
<span style=color:#f92672>==============================</span> <span style=color:#ae81ff>1</span> failed in 0.03s <span style=color:#f92672>==============================</span>
Bisecting: <span style=color:#ae81ff>4</span> revisions left to test after this <span style=color:#f92672>(</span>roughly <span style=color:#ae81ff>2</span> steps<span style=color:#f92672>)</span>
<span style=color:#f92672>[</span>41dd4aa10cf685f0671659283980eefb3d9c5468<span style=color:#f92672>]</span> Update foo.py
running pytest tests/test_foo.py::test_bar
<span style=color:#f92672>=============================</span> test session starts <span style=color:#f92672>==============================</span>
platform linux -- Python 3.12.10, pytest-8.3.3
rootdir: /home/user/project
collected <span style=color:#ae81ff>1</span> item

tests/test_foo.py F                                                     <span style=color:#f92672>[</span>100%<span style=color:#f92672>]</span>

<span style=color:#f92672>==================================</span> FAILURES <span style=color:#f92672>===================================</span>
__________________________________ test_bar __________________________________

    def test_bar<span style=color:#f92672>()</span>:
&gt;       assert foo.bar<span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>42</span>
E       AssertionError: assert 41 <span style=color:#f92672>==</span> <span style=color:#ae81ff>42</span>
E        +  where 41 <span style=color:#f92672>=</span> &lt;<span style=color:#66d9ef>function</span> bar at 0x7f9b1c3e6f70&gt;<span style=color:#f92672>()</span>
E        +    where &lt;<span style=color:#66d9ef>function</span> bar at 0x7f9b1c3e6f70&gt; <span style=color:#f92672>=</span> foo.bar

tests/test_foo.py:8: AssertionError
<span style=color:#f92672>===========================</span> short test summary info <span style=color:#f92672>===========================</span>
FAILED tests/test_foo.py::test_bar - AssertionError: assert 41 <span style=color:#f92672>==</span> 42
<span style=color:#f92672>==============================</span> <span style=color:#ae81ff>1</span> failed in 0.03s <span style=color:#f92672>==============================</span>
Bisecting: <span style=color:#ae81ff>2</span> revisions left to test after this <span style=color:#f92672>(</span>roughly <span style=color:#ae81ff>1</span> step<span style=color:#f92672>)</span>
<span style=color:#f92672>[</span>c6ece2440925057a362da7ad41cb689c09e6503b<span style=color:#f92672>]</span> Refactor foo.py
running pytest tests/test_foo.py::test_bar
<span style=color:#f92672>=============================</span> test session starts <span style=color:#f92672>==============================</span>
platform linux -- Python 3.12.10, pytest-8.3.3
rootdir: /home/user/project
collected <span style=color:#ae81ff>1</span> item

tests/test_foo.py .                                                     <span style=color:#f92672>[</span>100%<span style=color:#f92672>]</span>

<span style=color:#f92672>==============================</span> <span style=color:#ae81ff>1</span> passed in 0.01s <span style=color:#f92672>==============================</span>
Bisecting: <span style=color:#ae81ff>0</span> revisions left to test after this <span style=color:#f92672>(</span>roughly <span style=color:#ae81ff>1</span> step<span style=color:#f92672>)</span>
<span style=color:#f92672>[</span>5f5248584dc4c435a89c708998b2b17115aa36e5<span style=color:#f92672>]</span> Minor changes to foo.py
running pytest tests/test_foo.py::test_bar
<span style=color:#f92672>=============================</span> test session starts <span style=color:#f92672>==============================</span>
platform linux -- Python 3.12.10, pytest-8.3.3
rootdir: /home/user/project
collected <span style=color:#ae81ff>1</span> item

tests/test_foo.py F                                                     <span style=color:#f92672>[</span>100%<span style=color:#f92672>]</span>

<span style=color:#f92672>==================================</span> FAILURES <span style=color:#f92672>===================================</span>
__________________________________ test_bar __________________________________

    def test_bar<span style=color:#f92672>()</span>:
&gt;       assert foo.bar<span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>42</span>
E       AssertionError: assert 41 <span style=color:#f92672>==</span> <span style=color:#ae81ff>42</span>
E        +  where 41 <span style=color:#f92672>=</span> &lt;<span style=color:#66d9ef>function</span> bar at 0x7f9b1c3e6f70&gt;<span style=color:#f92672>()</span>
E        +    where &lt;<span style=color:#66d9ef>function</span> bar at 0x7f9b1c3e6f70&gt; <span style=color:#f92672>=</span> foo.bar

tests/test_foo.py:8: AssertionError
<span style=color:#f92672>===========================</span> short test summary info <span style=color:#f92672>===========================</span>
FAILED tests/test_foo.py::test_bar - AssertionError: assert 41 <span style=color:#f92672>==</span> 42
<span style=color:#f92672>==============================</span> <span style=color:#ae81ff>1</span> failed in 0.03s <span style=color:#f92672>==============================</span>
5f5248584dc4c435a89c708998b2b17115aa36e5 is the first bad commit
commit 5f5248584dc4c435a89c708998b2b17115aa36e5
Author: John Doe &lt;john.doe@example.com&gt;
Date:   Mon Jul <span style=color:#ae81ff>10</span> 19:21:31 <span style=color:#ae81ff>2023</span> +0200

    Minor changes to foo.py

 foo.py | <span style=color:#ae81ff>2</span> +-
 <span style=color:#ae81ff>1</span> file changed, <span style=color:#ae81ff>1</span> insertion<span style=color:#f92672>(</span>+<span style=color:#f92672>)</span>, <span style=color:#ae81ff>1</span> deletion<span style=color:#f92672>(</span>-<span style=color:#f92672>)</span>
bisect run success
</code></pre></div><p>To suppress all this noise you can redirect the output to /dev/null and grep from the log:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git bisect run pytest tests/test_foo.py::test_bar &gt; /dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span>
git bisect log | grep <span style=color:#e6db74>&#34;first bad commit&#34;</span>
</code></pre></div></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://www.robert-sokolewicz.nl/posts/23_nested-context-managers/><span class=button__icon>←</span>
<span class=button__text>Nesting context managers</span></a></span>
<span class="button next"><a href=https://www.robert-sokolewicz.nl/posts/19_fish_and_starship/><span class=button__text>Auto activating conda environments when moving between projects</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://www.robert-sokolewicz.nl/assets/main.js></script><script src=https://www.robert-sokolewicz.nl/assets/prism.js></script></div></body></html>